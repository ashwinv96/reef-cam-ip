<!DOCTYPE html>
<html>
<head>
    <title>Reef Cam MVP</title>
    <script>
        function checkStatus(cameraId) {
            fetch(`/status/${cameraId}`)
                .then(res => res.json())
                .then(data => {
                    const button = document.getElementById(`timelapse-btn-${cameraId}`);
                    const status = document.getElementById(`timelapse-status-${cameraId}`);
                    if (data.active) {
                        button.disabled = true;
                        status.textContent = `⏳ Timelapse running... (${data.seconds_left}s left)`;
                    } else {
                        button.disabled = false;
                        status.textContent = "";
                    }
                });
        }

        function startPolling() {
            setInterval(() => {
                {% for camera_id in cameras %}
                checkStatus("{{ camera_id }}");
                {% endfor %}
            }, 5000); // poll every 5s
        }

        window.onload = startPolling;
    </script>
</head>
<body>
    <h1>Live Reef Streams</h1>

    {% for camera_id, config in cameras.items() %}
    <h2>Camera {{ loop.index }}</h2>
    <img src="/video_feed/{{ camera_id }}" width="640"><br>
    <form action="/snapshot/{{ camera_id }}"><button type="submit">📸 Snapshot {{ camera_id }}</button></form>
    <form action="/trigger_timelapse/{{ camera_id }}" method="POST">
        <input type="hidden" name="snapshot_interval" value="10">
        <input type="hidden" name="video_interval" value="300">
        <button type="submit" id="timelapse-btn-{{ camera_id }}">🎞️ Trigger Timelapse {{ camera_id }}</button>
        <span id="timelapse-status-{{ camera_id }}" style="margin-left: 10px; color: gray;"></span>
    </form>
    {% endfor %}
</body>
</html>
